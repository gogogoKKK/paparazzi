<!DOCTYPE flight_plan SYSTEM "flight_plan.dtd">

<flight_plan alt="0.5" ground_alt="0" lat0="51.9906340" lon0="4.3767889" max_dist_from_home="5" name="Rotorcraft Optitrack (Delft)" security_height="0.1">
  <header>
#include "subsystems/datalink/datalink.h"
#include "subsystems/electrical.h"
#include "subsystems/radio_control.h"
#include "subsystems/ahrs.h"
#include "autopilot.h"
inline void setNav(void){
autopilot_mode_auto2 = AP_MODE_NAV;
autopilot_static_set_mode(AP_MODE_NAV);
}
inline void setGuided(void){
autopilot_mode_auto2 = AP_MODE_GUIDED;
autopilot_static_set_mode(AP_MODE_GUIDED);
}
inline void setModule(void){
autopilot_mode_auto2 = AP_MODE_MODULE;
autopilot_static_set_mode(AP_MODE_MODULE);
}
</header>
  <waypoints>
    <waypoint name="HOME" x="-0." y="-0.6"/>
  </waypoints>
  <blocks>
    <block name="Wait GPS">
      <call_once fun="NavKillThrottle()"/>
      <while cond="!GpsFixValid()"/>
    </block>
    <block name="Holding point">
      <call_once fun="NavKillThrottle()"/>
      <attitude pitch="0" roll="0" throttle="0" until="FALSE" vmode="throttle"/>
    </block>
    <block name="Start Engine">
      <call_once fun="NavResurrect()"/>
<!--      <call_once fun="NavSetWaypointHere(WP_STDBY)"/>-->
      <attitude pitch="0" roll="0" throttle="0" until="FALSE" vmode="throttle"/>
    </block>
<!--    <block name="Takeoff" strip_button="Takeoff" strip_icon="takeoff.png">-->
<!--        <set var="nav_heading" value="270"/>-->
<!--        <go wp="HOME" alt="0.4" />-->
<!--        <deroute block="Standby"/>-->
<!--    </block>-->
    <block name="Standby" strip_button="Standby" strip_icon="home.png">
<!--      <heading course="-90" throttle="0" until="FALSE" vmode="throttle"/>-->
<!--    <call_once fun="nav_set_heading_deg(-90)"/>-->
      <stay wp="HOME" alt="0.8" />
    </block>
    <block key="g" name="START">
      <call_once fun="setModule()"/>
      <stay wp="HOME"/>
    </block>
    <block name="flare">
      <call_once fun="setNav()"/>
      <exception cond="NavDetectGround()" deroute="Holding point"/>
      <exception cond="!nav_is_in_flight()" deroute="landed"/>
      <call_once fun="NavStartDetectGround()"/>
      <stay climb="nav_descend_vspeed" vmode="climb" wp="HOME"/>
    </block>
    <block name="landed">
      <call_once fun="setNav()"/>
      <call_once fun="NavKillThrottle()"/>
      <attitude pitch="0" roll="0" throttle="0" until="FALSE" vmode="throttle"/>
    </block>
  </blocks>
</flight_plan>
